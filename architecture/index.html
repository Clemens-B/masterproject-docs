
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.2">
    
    
      
        <title>3.1 Architekur - Masterprojekt 2017 Doks</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-e2807e330f.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Masterprojekt 2017 Doks" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  3. Architekur & Prozesse
                </span>
              
            
            3.1 Architekur
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Masterprojekt 2017 Doks
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="1. Einleitung" class="md-nav__link">
      1. Einleitung
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../design/" title="2. Design & UI" class="md-nav__link">
      2. Design & UI
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      3. Architekur & Prozesse
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        3. Architekur & Prozesse
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        3.1 Architekur
      </label>
    
    <a href="./" title="3.1 Architekur" class="md-nav__link md-nav__link--active">
      3.1 Architekur
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#einleitung" title="Einleitung" class="md-nav__link">
    Einleitung
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webrtc-multi-user-topologie" title="WebRTC Multi-User Topologie" class="md-nav__link">
    WebRTC Multi-User Topologie
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#star-topologie-designs" title="Star-Topologie-Designs" class="md-nav__link">
    Star-Topologie-Designs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcu" title="MCU" class="md-nav__link">
    MCU
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcu-mit-kurento" title="MCU mit Kurento" class="md-nav__link">
    MCU mit Kurento
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vor-und-nachteile" title="Vor- und Nachteile" class="md-nav__link">
    Vor- und Nachteile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sfu" title="SFU" class="md-nav__link">
    SFU
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sfu-mit-kurento" title="SFU mit Kurento" class="md-nav__link">
    SFU mit Kurento
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vor-und-nachteile_1" title="Vor- und Nachteile" class="md-nav__link">
    Vor- und Nachteile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-server-medienserver-architektur" title="Client-Server-MedienServer Architektur" class="md-nav__link">
    Client-Server-MedienServer Architektur
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architektur" title="Architektur" class="md-nav__link">
    Architektur
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tech-stack" title="Tech-Stack" class="md-nav__link">
    Tech-Stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referenzen" title="Referenzen" class="md-nav__link">
    Referenzen
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sequenz/" title="3.2 Sequenzdiagramm" class="md-nav__link">
      3.2 Sequenzdiagramm
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../socket-api/" title="4. API" class="md-nav__link">
      4. API
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#einleitung" title="Einleitung" class="md-nav__link">
    Einleitung
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webrtc-multi-user-topologie" title="WebRTC Multi-User Topologie" class="md-nav__link">
    WebRTC Multi-User Topologie
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#star-topologie-designs" title="Star-Topologie-Designs" class="md-nav__link">
    Star-Topologie-Designs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcu" title="MCU" class="md-nav__link">
    MCU
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcu-mit-kurento" title="MCU mit Kurento" class="md-nav__link">
    MCU mit Kurento
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vor-und-nachteile" title="Vor- und Nachteile" class="md-nav__link">
    Vor- und Nachteile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sfu" title="SFU" class="md-nav__link">
    SFU
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sfu-mit-kurento" title="SFU mit Kurento" class="md-nav__link">
    SFU mit Kurento
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vor-und-nachteile_1" title="Vor- und Nachteile" class="md-nav__link">
    Vor- und Nachteile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-server-medienserver-architektur" title="Client-Server-MedienServer Architektur" class="md-nav__link">
    Client-Server-MedienServer Architektur
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architektur" title="Architektur" class="md-nav__link">
    Architektur
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tech-stack" title="Tech-Stack" class="md-nav__link">
    Tech-Stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referenzen" title="Referenzen" class="md-nav__link">
    Referenzen
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>3.1 Architekur</h1>
                
                <h2 id="einleitung">Einleitung<a class="headerlink" href="#einleitung" title="Permanent link">&para;</a></h2>
<p>Wichtige Kapitel:</p>
<ol>
<li><a href="#sfu">SFU Architektur</a></li>
<li><a href="#client-server-medienserver-architektur">Client-Server-MedienServer Architektur</a></li>
</ol>
<p>Beipiele für unterschiedliche Topologie-Implementierungen:</p>
<p><strong>Mesh:</strong> <a href="https://appear.in/">appear.in</a><br>
<strong>MCU:</strong> <a href="https://www.bluejeans.com/de/">bluejeans.com</a> (kostenpflichtig)<br>
<strong>SFU:</strong> <a href="https://meet.jit.si/">jitsi.org</a></p>
<h2 id="webrtc-multi-user-topologie">WebRTC Multi-User Topologie<a class="headerlink" href="#webrtc-multi-user-topologie" title="Permanent link">&para;</a></h2>
<p>In WebRTC Multi-User Anwendungen lässt sich zunächst zwischen Star- und Mesh-Topologie unterscheiden. Beim Meshdesign ist jeder User mit jedem anderen User über einen Peer verbunden, wohingegen bei der Startopologie ein zentrales System die Streams eines Users an andere User weiterleitet.</p>
<p><center><img src="/images/simple-star-top.png" width="300"><br>
<small>Einfache Darstellung der Star-Topologie</small>
</center></p>
<p>Für die Implementierung einer Star-Topologie wird ein sog. WebRTC-Medien-Server verwendet. Im Rahmen dieses Projektes wurde sich für <a href="http://www.kurento.org/">Kurento</a> als Basis der gesamten Anwendung entschieden.</p>
<h2 id="star-topologie-designs">Star-Topologie-Designs<a class="headerlink" href="#star-topologie-designs" title="Permanent link">&para;</a></h2>
<p>Innerhalb des Star-Topologie-Design lässt sich weiterhin zwischen <em>Selective Forwarding Unit</em> (<strong>SFU</strong>) und <em>Multipoint Conferencing Unit</em> (<strong>MCU</strong>) unterscheiden. Im Folgenden wird nun näher auf die einzelnen Designs eingegangen und deren Implementierung mit Kurento. Im Rahmen des Projektes wird die SFU-Architektur umgesetzt. <a href="">Hier</a> kann direkt das MCU-Kapitel übersprungen werden.</p>
<h3 id="mcu">MCU<a class="headerlink" href="#mcu" title="Permanent link">&para;</a></h3>
<p>MCU steht für "Multipoint Conferencing Unit". Ein MCU bietet die Möglichkeit, mehrere Teilnehmer in einem einzelnem Audio/+Video Stream zu verbinden. Die Media-Streams der einzelnen Teilnehmer werden dabei zu einem einzigen Stream gemixt, d.h. es besteht nur ein Upload-Stream für das gesendete Video/Audio und ein Download-Stream für das Video/Audio der restlichen Teilnehmer. In folgender Abbildung wird deutlich, dass die Teilnehmer je nur eine Verbindung zum Medien-Server haben und der Medien-Server insgesamt 5 Verbinden offen hat: </p>
<p><center><img src="/images/mcu.png" width="300"><br>
<small>Connections: 1 | 5 </small><br>
<small>MCU Architektur</small>
</center></p>
<p>Um dies zu erreichen, müssen die einzelnen Streams der Teilnehmer zu einem Stream kompiniert werden. In MCU muss also folgendes für jeden Teilnehmer leisten:</p>
<p><center><img src="/images/mcu-processing.png" ><br>
<small>Verarbeitung der Media-Streams von einer MCU</small>
</center></p>
<p>Die Kombination mehrerer Streams erfordert viele Ressourcen des MCU. In der Darstellung ist der Ressourcenaufwand von grün zu rot markiert, mit welcher die CPU belastet wird.</p>
<h4 id="mcu-mit-kurento">MCU mit Kurento<a class="headerlink" href="#mcu-mit-kurento" title="Permanent link">&para;</a></h4>
<p>Mit Kurento ist ein kombinierter Stream möglich. Dazu wird zunächst eine Mediapipeline erstellt und diese als kombinierter Stream konfiguriert. Ein Hub auf dieser kombinierten Pipeline, sorgt dafür, dass alle Clients andocken können.</p>
<div class="codehilite"><pre><span></span><span class="nx">kurento</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;MediaPipeline&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">mediaPipeline</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="nx">error</span><span class="p">;</span>
    <span class="nx">mediaPipeline</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">composite</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="nx">error</span><span class="p">;</span>
        <span class="nx">composite</span><span class="p">.</span><span class="nx">createHubPort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">hubPort</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="nx">hubPort</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">webRtcEndpoint</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="nx">onerror</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

                <span class="p">[....]</span>

<span class="p">});</span>
</pre></div>


<h4 id="vor-und-nachteile">Vor- und Nachteile<a class="headerlink" href="#vor-und-nachteile" title="Permanent link">&para;</a></h4>
<p>Vorteil:</p>
<ul>
<li>wenig Networkverkehr</li>
</ul>
<p>Nachteile:</p>
<ul>
<li>hoher Ressourcenverbrauch</li>
<li>festes Grid für Videos</li>
<li>Lange Setup-Zeit, um Call zu etablieren (bei bluejeans <a href="https://testrtc.com/wp-content/uploads/2016/03/201603-mcu-1.png">im Durchschnitt 24 Sekunden</a> bis ein Teilnehmer am Chat teilnehmen kann)</li>
</ul>
<h3 id="sfu">SFU<a class="headerlink" href="#sfu" title="Permanent link">&para;</a></h3>
<p>SFU steht für "Selective Forwarding Unit". In einer SFU empfängt der Teilnehmer alle Streams der anderen User einzeln. Jedoch im Gegensatz zum Mesh-Design wird sein eigener Stream nur einmal an den Medien-Server geleitet. Der Medien-Server dient somit als eine Art Router, der entscheidet, welcher User welchen Stream angezeigt bekommt. Dies hat den Vorteil, dass für jeden Stream ein Video-Element kreiert werden kann und so dieses in der Größe etc. angepasst werden kann. Des Weiteren ist die Setup-Zeit für einen Call geringer, da der Stream nicht mehr mit den anderen Streams gemergt werden muss (siehe MCU), was wiederum zu einer geringeren Last auf dem Medien-Server bedeutet. In folgender Abbildung wird deutlich, dass der Nutzer seinen eigenen Stream nur einmal uploaded, dafür aber von jedem Teilnehmer einen Stream empfängt:</p>
<p><center><img src="/images/sfu.png" width="300"><br>
<small>Connections: 5 | 25 </small><br>
<small>SFU Architektur</small>
</center></p>
<p>Im Gegensatz zur MCU wird hier der Stream der Teilnehmer nicht kombiniert, sondern einfach nur weitergeleitet. Somit sieht die Verarbeitung von Video/Audio in einer SFU wie folgt aus:</p>
<p><center><img src="/images/sfu-processing.png"><br>
<small>Verarbeitung der Media-Streams von einer SFU</small>
</center></p>
<h4 id="sfu-mit-kurento">SFU mit Kurento<a class="headerlink" href="#sfu-mit-kurento" title="Permanent link">&para;</a></h4>
<p>Für eine SFU mit Kurento wird zunächst für jeden Raum eine Media-Pipeline erstellt, auf der darauf die verschiedenen WebRTC-Endpoints registriert werden. In der Beispiel-Abbildung mit 5 Usern hat jeder User 5 WebRTC-Endpoints:</p>
<p>Ein Outgoing-Endpoint<br>
Vier Incoming-Endpoints</p>
<p>D.h. für einen User wird zunächst ein Outgoing-Endpoint erstellt. Folgender Pseudo-Code geht davon aus, dass noch keine Media-Pipeline erstellt wurde (Room-Creator).</p>
<div class="codehilite"><pre><span></span><span class="nx">kurento</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;MediaPipeline&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">mediaPipeline</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="nx">error</span><span class="p">;</span>
    <span class="nx">mediaPipeline</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;WebRtcEndpoint&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">outgoingMedia</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="nx">error</span><span class="p">;</span>
        <span class="nx">user</span><span class="p">.</span><span class="nx">outgoingMedia</span> <span class="o">=</span> <span class="nx">outgoingMedia</span><span class="p">;</span>

        <span class="nx">user</span><span class="p">.</span><span class="nx">outgoingMedia</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;OnIceCandidate&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;generate outgoing candidate : &quot;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="nx">kurento</span><span class="p">.</span><span class="nx">register</span><span class="p">.</span><span class="nx">complexTypes</span><span class="p">.</span><span class="nx">IceCandidate</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">candidate</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="p">[....]</span>

<span class="p">});</span>
</pre></div>


<p>Auf Client-Seite bedeutet dies, dass hierfür nur ein send-only Kanal für den User erstellt werden sollte. Gleichzeitig sollte für die anderen 4 User nur ein read-only Kanal erstellt werden. Auf Server-Seite wird dafür </p>
<div class="codehilite"><pre><span></span><span class="nx">getEndpointForUser</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">sender</span><span class="p">){</span>
    <span class="nx">mediaPipeline</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;WebRtcEndpoint&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">incomingMedia</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="nx">error</span><span class="p">;</span>
        <span class="nx">user</span><span class="p">.</span><span class="nx">incomingMedia</span><span class="p">[</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">incomingMedia</span><span class="p">;</span>

        <span class="nx">user</span><span class="p">.</span><span class="nx">incomingMedia</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;OnIceCandidate&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;generate incoming media candidate : &quot;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; from &quot;</span> <span class="o">+</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="nx">kurento</span><span class="p">.</span><span class="nx">register</span><span class="p">.</span><span class="nx">complexTypes</span><span class="p">.</span><span class="nx">IceCandidate</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">candidate</span><span class="p">);</span>
            <span class="p">});</span>

        <span class="p">[....]</span>

    <span class="p">)}</span>        
<span class="p">};</span>
</pre></div>


<h4 id="vor-und-nachteile_1">Vor- und Nachteile<a class="headerlink" href="#vor-und-nachteile_1" title="Permanent link">&para;</a></h4>
<p>Vorteile:</p>
<ul>
<li>Einzelne Videoelemente für jeden Teilnehmer</li>
<li>Schneller Call-Aufbau</li>
<li>Im Gegensatz zu MCU wenig Ressourcen-Verbrauch</li>
</ul>
<p>Nachteil:</p>
<ul>
<li>Netzwerk-Verkehr nicht ganz so gering wie bei MCU</li>
</ul>
<h2 id="client-server-medienserver-architektur">Client-Server-MedienServer Architektur<a class="headerlink" href="#client-server-medienserver-architektur" title="Permanent link">&para;</a></h2>
<p>Für die Implementierung eines SFU sind folgende Komponenten notwendig:</p>
<ol>
<li>Client<br>
<small>Zuständig für: Senden und Empfangen der Media-Streams, Signaling, ...</small></li>
<li>Application Server<br>
<small>Zuständig für: Signaling, Kurento-API-Anbindung, ...</small></li>
<li>Kurento Media-Server<br>
<small>Zuständig für: IceCanditaten-Erstellung, Stun + Turn, Media-Streams, ...</small></li>
</ol>
<h3 id="architektur">Architektur<a class="headerlink" href="#architektur" title="Permanent link">&para;</a></h3>
<p>Der Application-Server stellt zum Client eine Verbindung via Websocket her, um hierdrüber die SDP-Offers/-Answers auszutauschen. Diese werden daraufhin vom Application-Server bei Kurento regestriert, nachdem eine Media-Pipeline für den jeweiligen Raum erstellt wurde.</p>
<p><center><img src="/images/architecture.png" width=""><br>
<small>Vereinfachte Darstellung der Architektur</small>
</center></p>
<p>Dies bedeutet, das im Rahmen dieses Projektes der Appikation-Server entwickelt werden muss, der das Signalling im Trickle ICE Format übernimmt und eine Verbindung zu Kurento aufbaut.</p>
<p>Die Architektur lässt sich ausführlicher wie folgt darstellen:
<center><img src="/images/architecture-complex.png" width=""><br>
<small>Architektur Darstellung nach <a href="http://doc-kurento.readthedocs.io/en/stable/mastering/kurento_architecture.html">Kurento</a></small>
</center></p>
<h3 id="tech-stack">Tech-Stack<a class="headerlink" href="#tech-stack" title="Permanent link">&para;</a></h3>
<p>Der Client und Appication-Server kommunizieren dabei über eine Schnittstelle (siehe API). Da ein Ziel der Anwendung auch ein Text-Chat ist, bietet sich als Schnittstellen-Protokoll Websocket bzw. socket.io an. </p>
<p>Als Client wird Angular2+ verwendet. Der Application-Server basiert auf Node.js. Kurento ist Open-Source und in C geschrieben</p>
<h2 id="referenzen">Referenzen<a class="headerlink" href="#referenzen" title="Permanent link">&para;</a></h2>
<p><a href="https://webrtcglossary.com/sfu/">https://webrtcglossary.com/sfu/</a><br>
<a href="https://webrtcglossary.com/mcu/">https://webrtcglossary.com/mcu/</a><br>
<a href="https://bloggeek.me/webrtc-multiparty-video-alternatives/">https://bloggeek.me/webrtc-multiparty-video-alternatives/</a><br>
<a href="https://testrtc.com/different-multiparty-video-conferencing/">https://testrtc.com/different-multiparty-video-conferencing/</a><br>
<a href="http://doc-kurento.readthedocs.io/en/stable/mastering/kurento_architecture.html">http://doc-kurento.readthedocs.io/en/stable/mastering/kurento_architecture.html</a></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../design/" title="2. Design & UI" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                2. Design & UI
              </span>
            </div>
          </a>
        
        
          <a href="../sequenz/" title="3.2 Sequenzdiagramm" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                3.2 Sequenzdiagramm
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-6b599127bc.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>